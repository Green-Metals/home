<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>overview – Critical Raw Materials Knowledge Hub</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
.display.math{display: block; text-align: center; margin: 0.5rem auto;}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-html-6b66b95abd978ad436a633db2cf312ca.min.css" rel="stylesheet" append-hash="true" data-mode="light">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="../../styles/site.css">
</head>

<body>




<nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview">00 Overview</a>
  <ul>
  <li><a href="#reading-order" id="toc-reading-order">Reading Order</a></li>
  <li><a href="#topic-map" id="toc-topic-map">Topic Map</a></li>
  </ul></li>
  <li><a href="#australia-focused-copper-evidence-review-research-report" id="toc-australia-focused-copper-evidence-review-research-report">Australia-Focused Copper Evidence Review: Research Report</a>
  <ul>
  <li><a href="#abstract" id="toc-abstract">Abstract</a></li>
  <li><a href="#executive-summary" id="toc-executive-summary">Executive Summary</a>
  <ul>
  <li><a href="#purpose-and-scope-summary" id="toc-purpose-and-scope-summary">Purpose and scope (summary)</a></li>
  <li><a href="#key-facts-and-findings-with-page-anchors-for-quantitative-claims" id="toc-key-facts-and-findings-with-page-anchors-for-quantitative-claims">Key facts and findings (with page anchors for quantitative claims)</a></li>
  <li><a href="#research-missions-logic-not-a-topic-list" id="toc-research-missions-logic-not-a-topic-list">Research missions (logic, not a topic list)</a></li>
  </ul></li>
  <li><a href="#topic-interface-t1-t6" id="toc-topic-interface-t1-t6">Topic Interface (T1-T6)</a></li>
  <li><a href="#introduction" id="toc-introduction">1. Introduction</a>
  <ul>
  <li><a href="#australia-first-framing" id="toc-australia-first-framing">1.1 Australia-first framing</a></li>
  <li><a href="#scope-and-exclusions" id="toc-scope-and-exclusions">1.2 Scope and exclusions</a></li>
  <li><a href="#boundary-condition-copper-plus-co-products" id="toc-boundary-condition-copper-plus-co-products">1.3 Boundary condition: copper plus co-products</a></li>
  </ul></li>
  <li><a href="#methods" id="toc-methods">2. Methods</a>
  <ul>
  <li><a href="#review-approach-scoping-review" id="toc-review-approach-scoping-review">2.1 Review approach (scoping review)</a></li>
  <li><a href="#evidence-handling-and-traceability" id="toc-evidence-handling-and-traceability">2.2 Evidence handling and traceability</a></li>
  <li><a href="#limitations" id="toc-limitations">2.3 Limitations</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
<h1 id="overview">00 Overview</h1>
<p>This file is the overview module for the split writeup pack.</p>
<h2 id="reading-order" class="anchored">Reading Order</h2>
<ol type="1">
<li><code>00_overview.md</code></li>
<li><code>01_T1_demand-and-value-chain.md</code></li>
<li><code>02_T2_processing-pathways.md</code></li>
<li><code>03_T3_science-101.md</code></li>
<li><code>04_T4_research-and-collaboration-landscape.md</code></li>
<li><code>05_T5_policy-funding-programs.md</code></li>
<li><code>06_T6_evidence-quality-gaps-confidence.md</code></li>
<li><code>90_references-and-appendices.md</code></li>
</ol>
<h2 id="topic-map" class="anchored">Topic Map</h2>
<ul>
<li><code>T1</code>: Demand Pull + Australia Value-Chain Structure</li>
<li><code>T2</code>: Processing Pathways Across Primary/Secondary Feeds and Co-products</li>
<li><code>T3</code>: Science 101 Technology Primer</li>
<li><code>T4</code>: Research and Collaboration Landscape</li>
<li><code>T5</code>: Policy, Funding, and Programs</li>
<li><code>T6</code>: Evidence Quality, Gaps, and Confidence</li>
</ul>
<h1 id="australia-focused-copper-evidence-review-research-report">Australia-Focused Copper Evidence Review: Research Report</h1>
<p><strong>Version:</strong> 2026-02-09<br>
<strong>Status:</strong> Internal draft<br>
<strong>Audience:</strong> Internal research group<br>
<strong>Primary goals:</strong> (a) research prioritisation, (b) industry partnership landscape positioning (Australia-first)<br>
<strong>Scope note:</strong> Digital process control / sensing is out of scope for this report (deferred).</p>
<h2 id="abstract" class="anchored">Abstract</h2>
<p>This report provides an Australia-first copper evidence review, oriented to future copper use and end-to-end value capture across mining and concentration, smelting/refining (midstream), alloys and semi-fabrication, manufacturing/end use, and circularity. A scoping review was conducted over a bounded corpus of public baselines, operator disclosures, and peer-reviewed technical literature (Appendix B). Retained quantitative claims used in the narrative are page-anchored and traceable through Appendix A. The evidence supports a two-mission analytical framing: (Mission A) low-carbon, impurity-tolerant processing and refining competitiveness; and (Mission B) circular copper and alloy loops from complex scrap and e-waste with explicit contamination and co-product-aware route design. Data centres are used as a near-term demand-side anchor for partner pull, supported by projected Australian data-centre electricity demand growth <span class="citation" data-cites="aemo-oxford-2025">(AEMO and Oxford Economics, 2025, 4)</span>. The report closes by identifying evidence gaps and baseline work that would strengthen Australia-specific capacity, flow, and cost understanding.</p>
<h2 id="executive-summary" class="anchored">Executive Summary</h2>
<h3 id="purpose-and-scope-summary" class="anchored">Purpose and scope (summary)</h3>
<p>The purpose of this report is to summarise the most defensible evidence and logic for an Australia-first copper analysis. The framing is end-to-end value capture: what Australia can not only mine, but also <strong>process, refine, specify, and circularly upgrade</strong>. The scope spans the full copper chain and uses <strong>copper plus co-products</strong> as a boundary condition where co-products materially affect route viability and environmental performance <span class="citation" data-cites="dong-2020">(Z. Dong et al., 2020, 1, 5)</span>.</p>
<p>Two observations drive the research logic. First, multiple outlooks indicate tightening copper supply-demand conditions under electrification. Second, Australia’s value capture is shaped by a small number of domestic midstream nodes and by the difficulty of upgrading complex secondary feeds into specification-compliant products. These observations map naturally to two research missions: midstream competitiveness and circular copper/alloys.</p>
<h3 id="key-facts-and-findings-with-page-anchors-for-quantitative-claims" class="anchored">Key facts and findings (with page anchors for quantitative claims)</h3>
<ul>
<li><strong>Global demand outlooks are materially higher than current levels.</strong> S&amp;P Global projects copper demand rising from <strong>28 Mt (2025)</strong> to <strong>42 Mt (2040)</strong> <span class="citation" data-cites="sp-global-2026a">(S&amp;P Global, 2026, 9)</span>. Wood Mackenzie projects <strong>42.7 Mtpa by 2035</strong> in its base case <span class="citation" data-cites="woodmackenzie-2025">(Wood Mackenzie, 2025, 3)</span>.</li>
<li><strong>Australian data-centre electricity demand is projected to rise substantially</strong>, which strengthens the case for strategy framing that emphasises reliable processing capacity, quality, and circular feed availability. AEMO/Oxford estimates <strong>3.9 TWh (FY25)</strong> rising to <strong>12.0 TWh (FY30)</strong> and <strong>34.5 TWh (FY50)</strong> <span class="citation" data-cites="aemo-oxford-2025">(AEMO and Oxford Economics, 2025, 4)</span>.</li>
<li><strong>Public Australian baseline signals show copper export value growth</strong>, rising from <strong>A$12.565b (2024-25)</strong> to <strong>A$17.648b (2026-27f)</strong> nominal <span class="citation" data-cites="disr-2025">(Department of Industry, Science and Resources, 2025, 60)</span>. However, export value alone does not resolve how value is captured across processing and circular flows.</li>
<li><strong>Impurity and penalty element management is central to concentrate economics and operability</strong> and influences concentrate value and negotiated terms <span class="citation" data-cites="lane-2016">(D. J. Lane et al., 2016, 2)</span>.</li>
<li><strong>Secondary-feed upgrading is technically and environmentally route-dependent.</strong> Printed circuit boards (PCBs) can reach copper contents of <strong>20-25%</strong> <span class="citation" data-cites="yang-2024">(F. Yang et al., 2024, 4)</span>, but route choice drives tradeoffs in contamination, energy use, and emissions <span class="citation" data-cites="torrubia-2024">(J. Torrubia et al., 2024, 1, 7–8)</span>.</li>
<li><strong>“Low-carbon” claims require explicit modelling and measurement.</strong> Wu et al.&nbsp;report an <strong>18% reduction</strong> in global warming potential for their bioleaching pathway compared to pyrometallurgical production <span class="citation" data-cites="wu-2025">(X. Wu et al., 2025, 7)</span>, and show strong sensitivity to electricity-transition scenarios <span class="citation" data-cites="wu-2025">(X. Wu et al., 2025, 9)</span>.</li>
</ul>
<h3 id="research-missions-logic-not-a-topic-list" class="anchored">Research missions (logic, not a topic list)</h3>
<p><strong>Mission A: Low-carbon, high-resilience midstream processing and refining.</strong> The central logic is that midstream nodes translate ore and secondary feeds into specification-compliant products, and their economics are sensitive to impurities, energy, reliability, and environmental constraints. A university contribution is to make these constraints measurable and predictable (impurity transfer functions, operating windows, abatement curves) using lab evidence and partner data.</p>
<p><strong>Mission B: Circular copper and alloys from complex secondary feeds.</strong> The central logic is that circular value capture depends on feed quality and contamination control, plus route design that is co-product-aware and environmentally defensible. A university contribution is to build the enabling evidence base (scrap characterisation, pre-treatment protocols, alloy tolerance thresholds, comparative TEA/LCA and MRV protocols) that reduces integration risk for partners.</p>
<h2 id="topic-interface-t1-t6" class="anchored">Topic Interface (T1-T6)</h2>
<p>The thematic structure of this report is fixed to six topic IDs: - <code>T1</code>: Demand Pull + Australia Value-Chain Structure - <code>T2</code>: Processing Pathways Across Primary/Secondary Feeds and Co-products - <code>T3</code>: Science 101 Technology Primer - <code>T4</code>: Research and Collaboration Landscape - <code>T5</code>: Policy, Funding, and Programs - <code>T6</code>: Evidence Quality, Gaps, and Confidence</p>
<p>Boundary controls: - <code>T3</code> contains technology fundamentals only (no policy/program framing). - <code>T6</code> contains confidence, evidence quality, and gap status only (no new thematic arguments). - <code>T1</code> and <code>T2</code> are separated as structure/demand versus processing-route mechanics.</p>
<h2 id="introduction" class="anchored">1. Introduction</h2>
<h3 id="australia-first-framing" class="anchored">1.1 Australia-first framing</h3>
<p>Australia’s copper position cannot be reduced to mining tonnage. Copper value is created and retained when material can be processed into consistent, specification-compliant products and when secondary copper can be upgraded without unacceptable contamination or emissions. This report therefore emphasises research themes that influence value capture across the chain, with particular attention to midstream resilience and circular feed upgrading.</p>
<h3 id="scope-and-exclusions" class="anchored">1.2 Scope and exclusions</h3>
<p>Scope covers: mining and concentration, smelting/refining, alloys/semi-fabrication, manufacturing/end use, and recycling/circularity.</p>
<p>Explicit exclusions for this report: - digital process control / sensing / ore sorting (deferred) - a complete owner/operator census for all Australian mines and downstream manufacturers (treated as baseline work)</p>
<h3 id="boundary-condition-copper-plus-co-products" class="anchored">1.3 Boundary condition: copper plus co-products</h3>
<p>Economic realism requires a boundary of <strong>copper plus co-products</strong> where project viability depends on co-product value and/or environmental constraints (for example, refining residues/anode slime pathways with multi-metal interactions) <span class="citation" data-cites="dong-2020">(Z. Dong et al., 2020, 1, 5)</span>.</p>
<h2 id="methods" class="anchored">2. Methods</h2>
<h3 id="review-approach-scoping-review" class="anchored">2.1 Review approach (scoping review)</h3>
<p>This report is based on a scoping review over a bounded corpus of: - public baselines (Australia and global) - operator disclosures and public announcements relevant to Australian midstream nodes - peer-reviewed technical literature relevant to impurity management, circular routes, and decarbonisation pathways</p>
<p>The intent is not a full systematic review. It is a strategy-focused synthesis designed to keep core claims traceable while remaining useful for program design and partner engagement.</p>
<h3 id="evidence-handling-and-traceability" class="anchored">2.2 Evidence handling and traceability</h3>
<p>Retained quantitative claims used in the narrative are page-anchored. Appendix A lists the claim-to-evidence mapping for retained quantitative claims used in the report.</p>
<h3 id="limitations" class="anchored">2.3 Limitations</h3>
<p>The main limitations are practical and affect interpretation: - Some datasets and market intelligence products are subscription-only (not in this corpus). - Several Australia-specific capacity, flow, and cost views are not harmonised into a single dataset; developing a harmonised baseline is part of the recommended near-term work.</p>

<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-aemo-oxford-2025" class="csl-entry" role="listitem">
AEMO and Oxford Economics 2025 <em>Data centre energy demand: Final report (july 2025)</em>.
</div>
<div id="ref-disr-2025" class="csl-entry" role="listitem">
Department of Industry, Science and Resources 2025 <em>Resources and energy quarterly: December 2025</em>.
</div>
<div id="ref-dong-2020" class="csl-entry" role="listitem">
Z. Dong, T. Jiang, B. Xu, J. Yang, Y. Chen, Q. Li, and Y. Yang 2020 <em>Comprehensive recoveries of selenium, copper, gold, silver and lead from a copper anode slime with a clean and economical hydrometallurgical process</em> Chemical Engineering Journal 395: 124762 <a href="https://doi.org/10.1016/j.cej.2020.124762">https://doi.org/10.1016/j.cej.2020.124762</a>.
</div>
<div id="ref-lane-2016" class="csl-entry" role="listitem">
D. J. Lane, N. J. Cook, S. R. Grano, and K. Ehrig 2016 <em>Selective leaching of penalty elements from copper concentrates: A review</em> Minerals Engineering 98: 110–121 <a href="https://doi.org/10.1016/j.mineng.2016.08.006">https://doi.org/10.1016/j.mineng.2016.08.006</a>.
</div>
<div id="ref-sp-global-2026a" class="csl-entry" role="listitem">
S&amp;P Global 2026 <em>Copper in the age of AI: Challenges of electrification</em>.
</div>
<div id="ref-torrubia-2024" class="csl-entry" role="listitem">
J. Torrubia, A. M. Parvez, M. Sajjad, F. A. G. Paz, and K. G. van den Boogaart 2024 <em>Recovery of copper from electronic waste: An energy transition approach to decarbonise the industry</em> Journal of Cleaner Production 475: 144349 <a href="https://doi.org/10.1016/j.jclepro.2024.144349">https://doi.org/10.1016/j.jclepro.2024.144349</a>.
</div>
<div id="ref-woodmackenzie-2025" class="csl-entry" role="listitem">
Wood Mackenzie 2025 <em>High-wire act: Is soaring copper demand an obstacle to future growth?</em>
</div>
<div id="ref-wu-2025" class="csl-entry" role="listitem">
X. Wu, X. Yang, and F. Zhao 2025 <em>Scaling bioleaching from lab to industry: A life cycle assessment of cathode copper production</em> ACS Sustainable Chemistry &amp; Engineering 13: 16577–16587 <a href="https://doi.org/10.1021/acssuschemeng.5c06793">https://doi.org/10.1021/acssuschemeng.5c06793</a>.
</div>
<div id="ref-yang-2024" class="csl-entry" role="listitem">
F. Yang, Y. Wu, and Q. Zhang 2024 <em>Towards resource regeneration: A focus on copper recovery from electronic waste</em> Journal of Cleaner Production 474: 144286 <a href="https://doi.org/10.1016/j.jclepro.2024.144286">https://doi.org/10.1016/j.jclepro.2024.144286</a>.
</div>
</div>

<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
    tabsets.forEach(function(tabset) {
      const tabby = new Tabby('#' + tabset.id);
    });
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/Green-Metals\.github\.io\/home\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>